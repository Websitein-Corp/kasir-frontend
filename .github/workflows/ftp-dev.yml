name: Deploy on Development Push
on:
  push:
    branches: [ dev/feature/cicd ]

jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v2
        with:
          node-version: '22'

      - name: npm install
        run: |
          npm install

      - name: npm build
        run: npm run build --if-present

      - name: copy index.html dist
        run:
          cp dist/index.html public/index.html

      - name: ðŸ“‚ Sync app files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.SERVER }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          exclude: |
            dist/**
            public/**
            node_modules/**/*
            .git/**/*
            .github/**/*
          server-dir: '../'
          local-dir: './'
          timeout: 9999999

      - name: ðŸ“‚ Sync public files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.SERVER }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          exclude: |
            node_modules/**/*
            vendor/**/*
            .git/**/*
            .github/**/*
            .env
          server-dir: './'
          local-dir: './public/'

      - name: ðŸ“‚ Sync dist files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.SERVER }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          exclude: |
            node_modules/**/*
            vendor/**/*
            .git/**/*
            .github/**/*
            .env
          server-dir: './'
          local-dir: './dist/'
